<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <div class="wrapup">
    <div class="header">
      <div class="pageback">
        <p><3</p>
      </div>
      <div class="title">
        <p>Daisuke</p>
        
      </div>
    </div>
    
      <div id="output" class="output">
          

      </div>
      <div> <input type="text" id="uname">
      </div>
      <div class="msg-area">
        <div class="textarea">
            <textarea id="text" cols="30" rows="10"></textarea>
          
        </div>
        <div class="btnarea">
          <button id="send">â–¶</button>
            
        </div>
      </div>
  </div>
<!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->



<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- JQuery -->


  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
    import { getDatabase, ref, push, set, onChildAdded, remove,onChildRemoved } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
    

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyAomOjAnTARMud1-5s_OUxPJuTLqGsD-hw",
      authDomain: "nakadtask.firebaseapp.com",
      databaseURL: "https://nakadtask-default-rtdb.firebaseio.com",
      projectId: "nakadtask",
      storageBucket: "nakadtask.appspot.com",
      messagingSenderId: "675884394008",
      appId: "1:675884394008:web:8bcd1a57dae6122c4ac56d",
      measurementId: "G-4P0MTT7FW4"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    
   const db = getDatabase(app) ;
   const dbRef = ref(db,'nakadtask') ;

//    é€ä¿¡å‡¦ç†
    $('#send').on('click', function(){
    // id="unameã®å ´æ‰€ã‚’å–å¾—"
    const uname = $('#uname').val();
    console.log(uname,'aaa');
    const text = $('#text' ).val();
    console.log(text,'bbb') ;
    const msg =  {
        uname : uname ,
        text : text ,
    }
    console.log(msg);

    // firebaseã«é€ã‚‹æº–å‚™
    const newPostRef = push(dbRef) ;
    set(newPostRef,msg) ;

    $("#uname").val("") ;
    $("#text").val("") ;

    $("#uname").focus();


})


// é€ä¿¡å‡¦ç†enterã‚­ãƒ¼ã§ã‚‚å¯¾å¿œ
$('#text').keypress( function(e){
    // id="unameã®å ´æ‰€ã‚’å–å¾—"
    const uname = $('#uname').val();
    console.log(uname,'aaa');
    const text = $('#text' ).val();
    console.log(text,'bbb') ;
    const msg =  {
        uname : uname ,
        text : text ,
    }
    console.log(msg);

    // firebaseã«é€ã‚‹æº–å‚™
    const newPostRef = push(dbRef) ;
    set(newPostRef,msg) ;

    $("#uname").val("") ;
    $("#text").val("") ;

    $("#uname").focus();


})



    
       // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°
        onChildAdded(dbRef, function (data) {
            // ã“ã“ã‹ã‚‰ãŒå—ä¿¡å‡¦ç†ãŒå§‹ã¾ã‚Šã¾ã™

            // ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ğŸ¤—
            const msg = data.val();
            console.log(msg, 'å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¡Š')
            const key = data.key;
            console.log(key, 'ãƒ‡ãƒ¼ã‚¿ã®å¡Šã«ã‚¢ã‚¯ã‚»ã‚¹')
        })

           // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°
           onChildAdded(dbRef, function (data) {
            // ã“ã“ã‹ã‚‰ãŒå—ä¿¡å‡¦ç†ãŒå§‹ã¾ã‚Šã¾ã™

            // ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ğŸ¤—
            const msg = data.val();
            console.log(msg, 'å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¡Š')
            const key = data.key;
            console.log(key, 'ãƒ‡ãƒ¼ã‚¿ã®å¡Šã«ã‚¢ã‚¯ã‚»ã‚¹')


            // es6ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«
            let h = `
                <div class="msg">
                    <p>${msg.uname}</p>
                    <p class="msgtext">${msg.text}</p>
                </div>    
            `;
            // htmlã«åŸ‹ã‚è¾¼ã¿ã¾ã—ã‚‡ã†ğŸ¤—
            // append();ã¨ã„ã†jqueryã®ãŠã¾ã˜ãªã„ã‚’ä½¿ã„ã¾ã™
            $("#output").append(h);
        })
  </script>
  
</body>
</html>